<!DOCTYPE html>
<html>
<head>

<script>

    function reparentChildren(oldNode, newNode) {
        while (oldNode.childNodes.length > 0) {
            newNode.appendChild(oldNode.childNodes[0]);
        }
    }
    
    function renameNode(node, newName) {
        var newNode = document.createElement(newName);
        newNode.attributes = node.attributes;
        node.parentNode.replaceChild(newNode, node);
        reparentChildren(node, newNode);
        return newNode;
    }

    function removeWrapperNode(node) {
        while(node.childNodes.length) {
            node.parentNode.insertBefore(node.childNodes[0], node);
        }
        node.parentNode.removeChild(node);
    }

    function massageNode(node) {
        switch(node.nodeName) {
            case 'STRONG':
                node = renameNode(node, 'b');
                break;
            case 'DIV':
            case 'SPAN':
                // Replace with its children
                removeWrapperNode(node);
                return -1;
        }

        if (node.nodeType === document.ELEMENT_NODE) {
            for (var i = 0; i < node.childNodes.length; i++) {
                i += massageNode(node.childNodes[i]);
            }
        } else if (node.nodeType === document.TEXT_NODE) {
            if (node.parentNode.nodeName !== 'PRE') {
                // Remove indents outside of preformatted text
                node.textContent = node.textContent.replace(/(\n|^)\s+/g, '$1');
            }
        }
        return 0;
    }

    function massageHTML(node) {
        for (var i = 0; i < node.childNodes.length; i++) {
            i += massageNode(node.childNodes[i]);
        }
    }

    function convert() {
        var data = new FormData();
        var htmlContentNode = document.getElementById('editable');
        massageHTML(htmlContentNode);
        data.append('html', htmlContentNode.innerHTML);
        var xhr = new XMLHttpRequest();
        xhr.open('POST', 'https://en.wikipedia.org/api/rest_v1/transform/html/to/wikitext', true);
        xhr.onload = function () {
            // do something to response
            document.getElementById('output').value = this.responseText
        };
        xhr.send(data);
    }
</script>

</head>
<body>
	Paste HTML here:
    <div id="editable" style="border: 2px solid red; min-height: 200px;" contenteditable="true"></div>
	<button onclick="return convert()">Clean up HTML and convert to Wikitext</button>
<p>Wikitext:</p>
    <textarea style="width:100%; min-height: 300px" id="output"></textarea>

    <h3>See also</h3>
    <ul>
        <li><a
                href="https://en.wikipedia.org/api/rest_v1/?doc#!/Transforms/post_transform_html_to_wikitext_title_revision">API
        end point used for HTML to Wikitext conversion</a></li>
        <li><a href="https://github.com/gwicke/paste2wiki">Check out the
                code</a></li>
    </ul>
</body>
</html>
